# Jenkins持续集成

## 概述
* 什么是持续集成
* 持续集成系统的组成部分
* 下载、安装和启动
* 下载和安装Jenkins的常用插件
* Jenkins的常用配置
* 使用Jenkins创建新任务并实现自动化集成和部署
* 了解任务状态的监控与邮件通知

---
## 1. 什么是持续集成
### 1.1 持续集成简介
持续集成即Continuous Integration，简称CI。持续集成指的是，频繁地（一天多次）将代码集成到主干。

### 1.2 持续集成的价值
1. 自动完成无需太多人工干预
2. 快速发现错误。每完成一点更新，就集成到主干，可以快速发现错误，定位错误也比较容易。
3. 防止分支大幅偏离主干。如果不是经常集成，主干又在不断更新，会导致以后集成的难度变大，甚至难以集成。

### 1.3 应用场景
多人同时开发提交代码到源码服务器，持续集成服务器轮询拿到源码编译运行

---
## 2. 组成部分及使用原则
### 2.1 CI的组成部分
* 版本控制系统(SVN/Git)
* CI Server
* web服务器

### 2.2 工作流程
提交代码到版本控制服务器--->CI服务器获取到代码--->自动化编译 测试 打包 部署--->部署到web服务器

### 2.3 使用原则
* 必须使用版本控制软件
* 开发人员必须及时向版本库中提交代码
* 开发环境要统一，例如JDK版本 Tomcat版本等
* 集成的频率要适当，建议一天集成两次

---

## 3. 下载与安装
### 3.1 下载安装
1. jav官网地址：[Jenkins](https://jenkins.io)
2. 下载LTS：长期支持稳定的版本 `war`包下载
3. 放在tomcat下启动即可

---

## 4. 下载和安装Jenkins的常用插件
### 4.1 从版本控制工具获取代码插件
系统管理--->管理插件--->可选插件--->(Git plugin/SVN)
### 4.2 部署项目插件
Deploy to container Plugin

---

## 5. Jenkins的常用配置
### 5.1 系统设置
1. Jenkins Location
Jenkins URL：自己配置。警告是建议使用IP地址
系统管理员邮箱：自己配置
2. 邮件通知
SMTP服务器：smtp.qq.com/...
后缀：qq.com
用户名密码：系统管理员邮箱信息
勾选ssl

### 5.2 Global Tool Configuration
都不要自动安装，粘贴已经下载好的地址

### 5.3 管理用户
可以修改admin密码和新建用户

---

## 6. 任务操作
### 6.1 创建一个任务
1. 创建一个新任务，填写任务名称
2. 自由风格的软件项目可以和maven等使用
3. 丢弃旧的构建可以设置旧的构建保留时间等
4. 重试次数(从代码仓库中取代码 出错尝试次数)

### 6.2 源码管理
填写git代码地址

### 6.3 构建触发器
在日程表中写入时间表达式 与普通cron有区别。[参考博客地址](https://www.cnblogs.com/lxs1314/p/7462741.html)

### 6.4 构建
增加构建步骤--->Invoke top-level Maven targets--->选择全局设置的maven--->设置命令(clean package)

### 6.5 部署
配置向导页面的构建后操作--->增加部署信息

---

## 7. 监控与邮件通知
### 7.1 状态监控
绿色小球：构建完成且稳定
黄色小球：构建完成不稳定
红色小球：构建失败
灰色小球：构建已禁用

大太阳：80+(通过单元测试 覆盖率 静态代码分析判断编译稳定性) 低于60不稳定
多云：60-79
阴天：40-59
小雨：20-39
雷电：0-19

### 7.2 邮件通知
在构建后配置邮件地址，多个邮箱用逗号分隔
